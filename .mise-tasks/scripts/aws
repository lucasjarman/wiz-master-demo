#!/usr/bin/env bash
# AWS CLI wrapper - validates credentials before running commands
# Supports: env vars, AWS_PROFILE, SSO, IMDS, credential_process

real_aws=$(mise which aws 2>/dev/null || which aws)

# Validate credentials by calling STS (works with any auth method)
if ! "$real_aws" sts get-caller-identity &>/dev/null; then
  echo "ERROR: No valid AWS credentials found." >&2
  echo "  Supported methods:" >&2
  echo "    - Environment: AWS_ACCESS_KEY_ID + AWS_SECRET_ACCESS_KEY" >&2
  echo "    - Profile: AWS_PROFILE or --profile" >&2
  echo "    - SSO: aws sso login" >&2
  echo "    - 1Password: eval \"\$(mise run auth)\"" >&2
  exit 1
fi

"$real_aws" "$@"
